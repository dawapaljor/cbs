---
import VideoJS from "../widgets/VideoJS.astro"
import AudioPlayer from "../widgets/AudioPlayer.astro"
import AudioWavePlayer from "../widgets/AudioWavePlayer.astro"
import SectionHeading from "../Section-Heading.astro"
import { getAudioContext } from '../../utils/audioContext.js';
const featuredImage = 'https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzRrdWNrbzN2d3ZkODJ5OHl0cDNxbDJ6enF0c3h6Nzc5b2NhODc2ZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/sdVWR1Mbb8VsCBKmVa/giphy.gif'
const title = "INDOCTRINATION"
const slug = "INDOCTRINATION"
const intro = ''
---
<script type="module" src="https://cdn.jsdelivr.net/npm/player.style/tailwind-audio/+esm"></script>
<!-- {
	docs.map(({ title,slug, Content }) => (
		<h2 class="" id={slug}>{title}</h2>
		<Content class="pt-10" />
	))
 }   -->

<div id="indoctrination" class="w-screen mx-auto ">
 <div class="flex box flex-col items-center">
  <SectionHeading {title} {featuredImage}></SectionHeading>

    <section class=" font-secondary max-w-7xl  text-gray-600 text-lg content relative">
      <AudioWavePlayer src="media/audio/audio-ty.m4a" caption="The Decline of Tibetan Language in State-Controlled Schools" id="audio-1"></AudioWavePlayer>
        <!-- <AudioPlayer src="media/audio/audio1.m4a" >  
        </AudioPlayer> -->
      <div class="">
        <AudioWavePlayer src="media/audio/audio-pk-bo.mp3" caption="When Tibetan Becomes a Foreign Tongue (Tibetan Voice)" id="audio-3-bo"></AudioWavePlayer>
        <AudioWavePlayer src="media/audio/audio-pk-eng.mp3" caption="When Tibetan Becomes a Foreign Tongue (English Voice)" id="audio-en"></AudioWavePlayer>
      </div>
    </section>

    <section class=" font-secondary max-w-7xl p-5 md:p-10 text-gray-600 text-xl content relative w-full">
     
      <div class="grid  gap-10 md:grid-cols-2  py-5"> 
        <VideoJS src="https://tai-web-video.s3.us-east-1.amazonaws.com/preschool-boarding/propaganda-song.mp4" poster="media/propaganda-song.png" id="probaganda-song"></VideoJS>
        <VideoJS src="https://tai-web-video.s3.us-east-1.amazonaws.com/preschool-boarding/red-track-suits.mp4" poster="media/red-suits.png"  id="red-track-suits"></VideoJS>
        <div>
          <VideoJS src="https://tai-web-video.s3.us-east-1.amazonaws.com/Daughterandmorthersupermarket.mp4" poster="media/daughtermothersupermarket.jpg"  id="daughtermothersupermarket"></VideoJS>
          <p class="text-sm font-Helv-Normal text-center">New York Times from Douyin</p>
        </div>
        <VideoJS src="https://tai-web-video.s3.us-east-1.amazonaws.com/preschool-boarding/Can'tspeaktibetan.mp4" poster="media/Can'tspeaktibetan.png"  id="cant-speak-tibetan"></VideoJS>
        <VideoJS src="media/banner-video.mp4"   id="cant-speak-tibetan"></VideoJS>
      </div>

</section>

</div>
</div>

<script type="module" src="https://cdn.jsdelivr.net/npm/videojs-video-element/+esm"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/player.style/tailwind-audio/+esm"></script>

<script>
import { gsap } from "gsap";
import ScrollTrigger from "gsap/ScrollTrigger";

gsap.registerPlugin(ScrollTrigger);

let boxes = gsap.utils.toArray(".box") as HTMLElement[];

boxes.forEach((box, i) => {
  const slug = box.querySelector('h1')?.id;
  if (slug) {
    const targetElement = document.querySelector(`#${slug}`);
    const heading = box.querySelector('h1');
    // Initial state
    gsap.set(heading, { opacity: 1 });
    // Scroll animation
    gsap.to(heading, {
      opacity: 0.2,
      scrollTrigger: {
        trigger: box,
        start: "top center",
        end: "bottom center",
        scrub: true,
        markers: false,
        pinSpacing:false,
        anticipatePin: 1,
      }
    });

    gsap.to(box, {
      duration: 1,
      scrollTrigger: {
        trigger: box,
        start: "100px 100px",
        end: "50% 10%",
        pin: targetElement,
        markers: true,
        pinSpacing:false,
        anticipatePin: 1,

      }
    });
  }
});

let banners = gsap.utils.toArray(".banner");

banners.forEach((banner) => {
  let heading = banner.querySelector("h1");
  if (heading) {
    gsap.fromTo(
      heading,
      { opacity: 1,
        scale: .5,

       },
      {
        opacity: 0,
        scale: 2,
        scrollTrigger: {
          trigger: banner,
          start: "top center",
          end: "bottom center",
          scrub: true,
          // pin: heading,
          // markers: true, // Uncomment for debugging
        },
      }
    );
  }
});
</script>
